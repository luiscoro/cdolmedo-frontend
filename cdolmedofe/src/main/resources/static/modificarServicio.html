<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<!-- estilos -->
	<link href="css/estilos.css" rel="stylesheet" type="text/css" />
	<!--para el login  -->
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Fuente -->

	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200&display=swap" rel="stylesheet">

	<!-- Botstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
<script src="/js/main.js"></script>
	<title>Integrante - CDOLMEDO</title>
</head>

<body>
	<script type="text/javascript">
		var rol = parseInt(localStorage.getItem("idRol"));
		if ((typeof localStorage.id === "undefined") ){
			alert("Acceso no permitido");
			window.location.href = "index.html";	
		}else{
			if(rol !== 3){
				alert("Usuario no permitido");
				window.location.href = "index.html";	
			}
		}
	</script>
	<script>
	var loadFile = function(event) {
	    var output = document.getElementById('output');
	    output.src = URL.createObjectURL(event.target.files[0]);
	  };
	</script>
	<script>
		const queryString = window.location.search;
		console.log(queryString);
		const urlParams = new URLSearchParams(queryString);
		const id = urlParams.get('id')
		var uuid;
		//console.log(id);
	</script>
	
	<script>
	$(document).ready(function() {
		$.getJSON('http://localhost:8080/api/servicio/'+id, function(json) {
			console.log(json.nombre)
			document.getElementById("nombre").value = json.nombre;
			document.getElementById("detalle").value = json.detalle;
			document.getElementById("estado").value = json.estado;
			document.getElementById("valor").value = json.valor;
			document.getElementById("descuento").value = json.descuento;
			document.getElementById("canjeo").value = json.canjeo;
			document.getElementById("idTipoServicio").value = json.idTipoServicio;
			document.getElementById("output").src = 'http://localhost:8080/api/pic/'+json.foto;
			uuid=json.foto;
		});
	});
	</script>
	<div class="cabecera">
		<!-- Cabecera -->
		<div class="cabeceraLogo">
			<a href="index.html"><img src="img/escudo.png"></a>

		</div>
		<div class="cabeceraNombre">
			<a href="index.html">Centro Deportivo<br> <strong>OLMEDO</strong></a>


		</div>
		<div class="cabeceraEsponsor">
			<div class="esponsor">

				<a href="index.html" target="_blank"><img src="img/esponsor1.png"></a>
			</div>
			<div class="esponsor">
				<a href="index.html" target="_blank"><img src="img/esponsor4.png"></a>

			</div>
			<div class="esponsor">
				<a href="index.html" target="_blank"><img src="img/esponsor5.jpg"></a>

			</div>

		</div>

		<div class="cabeceraBoton">
			<button class="botonGeneral" id="logout">
				<strong>CERRAR SESIóN</strong>
			</button>
			<br>
             <br>
             <div style="margin:0 auto;">
				<a class="nav-link" id="email" href="perfilUsuario.html" style="color: #FFFFFF; text-transform: capitalize;"></a>
				<script>			
					$(document).ready(function() {		
						var email= localStorage.getItem("mail");
						document.getElementById('email').innerHTML= email;
					});				
				</script> 
			</div>
             
		</div>
	</div> <!-- Fin Cabecera -->

	<div class="barramenu">
		<!-- Barra de menú -->
		<ul class="nav justify-content-center">
			<li class="nav-item">
				<a class="nav-link active" href="#">INICIO</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#">NOTICIAS</a>
			</li>
			<li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          SERVICIO
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarServicio.html">NUEVO</a>
				          <a class="dropdown-item" href="listarServicios.html">LISTAR SERVICIOS</a>
				         <!--  <div class="dropdown-divider"></div>
				          <a class="dropdown-item" href="#">Something else here</a> -->
				        </div>
				      </li>
			<li class="nav-item">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          SOCIO
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="listarComprobantes.html">APROBAR SOLICITUD</a>
							<a class="dropdown-item" href="listarSocios.html">LISTADO SOCIOS</a>
						</div>
			</li>

			 <li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          PUBLICACIÓN
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarPublicacion.html">NUEVA</a>
				          <a class="dropdown-item" href="listarPublicacion.html">LISTAR PUBLICACIONES</a>
				         <!--  <div class="dropdown-divider"></div>
				          <a class="dropdown-item" href="#">Something else here</a> -->
				        </div>
				      </li>
			 <li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          JUGADOR
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarintegrante.html">NUEVO</a>
				          <a class="dropdown-item" href="listarJugadores.html">LISTAR JUGADORES</a>

				        </div>
				      </li> 

		</ul>
	</div> <!-- Fin de barra de menú -->


	<header class="page-header0 header0 container-fluid0">
		<main class="cuerpo_pagina">
			<!-- CUERPO DE PAGINA -->

			<div class="cuerporegistro">
				<form action="#" method="put" enctype="multipart/form-data">
					<div class="form-group col-md-12">
						<h3>Modificar Servicio</h3>
						<hr style="background: #FFFFFF;">
					</div>
					<div class="form-group col-md-12">
						<label>Tipo de Servicio</label><br>
						<select name="idTipoServicio" id="idTipoServicio">
							<option value="1">Pagado</option>
							<option value="2">Gratuito</option>
						</select>
						<br>

					</div>
				
						<label for="nombre" class="col-form-label">Nombre</label>
						<input type="text" class="ingresodatos" id="nombre" placeholder="Nombre">
				
					
					
						<label for="detalle" class="col-form-label">Detalle</label>
						
						<textarea class="ingresodatosdos" id="detalle" rows="3" cols="39"
							placeholder="Detalle de Servicio.."></textarea>
					

					<div class="form-group col-md-12">
						<label for="foto" class="col-form-label">Actualizar foto</label>
						<p><img id="output" src="" width="80" class="rounded"></p>
						<input type="file" name="file" accept="image/*" class="form-control" />
					</div>

				
						<label for="nombre" class="col-form-label">Estado</label>
						<input type="text" class="ingresodatos" id="estado" placeholder="Nombre">
			


					
						<label for="valor" class="col-form-label">Valor</label>
						<input type="number" class="ingresodatos" id="valor" placeholder="Valor..">
					

				
						<label for="descuento" class="col-form-label">Descuento</label>
						<input type="number" class="ingresodatos" id="descuento" placeholder="30	%">
						
						<label for="canjeo" class="col-form-label">Puntos a ser canjeados</label>
						<input type="number" class="ingresodatos" id="canjeo" placeholder="150...">
					
						<br>
						<br>
						<hr style="background: #FFFFFF;">
					
						<input type="submit" class="botonGeneralCentrado" value="Modificar" id="save">
					

				</form>
			</div>


		</main><!--  FIN CUERPO DE PAGINA -->

	</header>

<script>
$(document).ready(function () {
	$(document).delegate('#save', 'click', function (event) {
		event.preventDefault();
		var nombre = $('#nombre').val();
		var detalle = $('#detalle').val();
		var estado = $('#estado').val();
		var valor = $('#valor').val();
		var descuento = $('#descuento').val();
		var canjeo = $('#canjeo').val();
		var idTipoServicio = $('#idTipoServicio').val();

		var img = $('input[name="file"]').get(0).files[0];
		console.log(img)

		var formData = new FormData();
		formData.append('img', img);
		var objArr = [];

		objArr.push({"id": id, "nombre": nombre, "detalle": detalle, "foto": uuid, "estado": estado, "valor": valor, "descuento": descuento, "canjeo": canjeo, "idTipoServicio": idTipoServicio});
		console.log(objArr);

		formData.append('servicio', JSON.stringify(objArr));
		console.log(formData);

		$.ajax({
			type: "PUT",
			url: "http://localhost:8080/api/servicio",
			data: formData,
			cache: false,
			processData: false,
			contentType: false,
			success: function (result) {
				console.log(result);
				$.alert({
						title: 'OK',
						content: 'El servicio ha sido actualizado!',
					});
				setTimeout(
					function () {
						window.location.href = "listarServicios.html";
					},2000);
			},
			error: function (xhr, exception) {
				if (xhr.status === 0)
					alert('Error : ' + xhr.status + 'You are not connected.');
				else if (xhr.status == "409"){
					$.alert({
						title: 'Error',
						content: 'Este nombre de integrante ya existe!',
					});
				}
				else if (xhr.status == "404")
					alert('Error : ' + xhr.status + '\nPage note found');
				else if (xhr.status == "500")
					alert('Internal Server Error [500].');
				else if (exception === 'parsererror')
					alert('Error : ' + xhr.status + '\nImpossible to parse result.');
				else if (exception === 'timeout')
					alert('Error : ' + xhr.status + '\nRequest timeout.');
				else
					alert('Error .\n' + xhr.responseText);
			}
		});
	});
	$('#logout').click(function() {
		      localStorage.clear();
		      window.location.href = "index.html";
	});
});
</script>
	<footer ><!-- Footer -->
            <div class="redesolmedo">
                <div class="redes">
                     <div class="contenedor-redes">
                   	 <img src="img/facebook.png">
                    </div>
                    <div class="contenedor-redes">
                   	 <img src="img/instagram.png">
                    </div>
                    <div class="contenedor-redes">
                   	 <img src="img/youtube.png">
                    </div>
                	<div class="contenedor-redes">
                    	<img src="img/twitter.png">
                    </div>
                    <div class="contenedor-redes">
                    	<img src="img/whatsapp.png">
                    </div>
                </div>
            </div>

            <div class="copyright">
                Desarrollado por CODETEAM para CDOLMEDO &copy; Riobamba 2020
            </div>
        </footer><!-- FIN footer-->

 <!-- Botstrap -->      
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>   

</body>
</html>
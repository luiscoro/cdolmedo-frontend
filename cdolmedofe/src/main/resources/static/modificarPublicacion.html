<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	
			
			<!-- dependencias omar -->
			<!--  
			<meta name="viewport" content="width=device-width, initial-scale=1">
		    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
-->
	        <!-- estilos -->
	        <link href="css/estilos.css" rel="stylesheet" type="text/css"/>
	        <!--para el login  -->
	        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	        <!-- Fuente -->
	        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200&display=swap" rel="stylesheet">
	        <!--  Jquery -->
            <script type="text/javascript" src="jquery/jquery-3.5.0.min.js"></script>
			<!-- Botstrap -->
			<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/css/bootstrap.min.css" integrity="sha384-VCmXjywReHh4PwowAiWNagnWcLhlEJLA5buUprzK8rxFgeH0kww/aWY76TfkUoSX" crossorigin="anonymous">
			<!--  JS -->
		<script src="js/controller.js"></script>
		<script src="js/validar.js"></script>
		<script src="/js/main.js"></script>


	<title>Modificar - CDOLMEDO</title>
</head>

<body>
	<script type="text/javascript">
		var rol = parseInt(localStorage.getItem("idRol"));
		if ((typeof localStorage.id === "undefined") ){
			alert("Acceso no permitido");
			window.location.href = "index.html";	
		}else{
			if(rol !== 3){
				alert("Usuario no permitido");
				window.location.href = "index.html";	
			}
		}
	</script>
	<script>
	var loadFile = function(event) {
	    var output = document.getElementById('output');
	    output.src = URL.createObjectURL(event.target.files[0]);
	  };
	</script>
	<script>
		const queryString = window.location.search;
		console.log(queryString);
		const urlParams = new URLSearchParams(queryString);
		const id = urlParams.get('id')
		var uuid;
		//console.log(id);
	</script>

	
	<script>
	$(document).ready(function() {
		$.getJSON('http://localhost:8080/api/publicacion/'+id, function(json) {
			console.log(json.nombre)
			document.getElementById("nombre").value = json.nombre;
			document.getElementById("detalle").value = json.detalle;
			document.getElementById("autor").value = json.autor;
			document.getElementById("idTipoPublicacion").value = json.idTipoPublicacion;
			document.getElementById("output").src = 'http://localhost:8080/api/pic/'+json.foto;
			uuid=json.foto;
		});
	});
	</script>

	<div class="cabecera"> <!-- Cabecera -->
            <div class="cabeceraLogo">
                <a href="index.html" ><img src="img/escudo.png" ></a>

            </div>
            <div class="cabeceraNombre">
                <a href="index.html">Centro Deportivo<br> <strong>OLMEDO</strong></a>


            </div>
            <div class="cabeceraEsponsor">
                <div class="esponsor">

                    <a href="index.html" target="_blank" ><img src="img/esponsor1.png" ></a>
                </div>
                <div class="esponsor">
                   <a href="index.html" target="_blank" ><img src="img/esponsor4.png" ></a>

                </div>
                <div class="esponsor">
                   <a href="index.html" target="_blank" ><img src="img/esponsor5.jpg" ></a>

                </div>

            </div>

            <div class="cabeceraBoton">
                <button class="botonGeneral" id="logout">
                    <strong>CERRAR SESIÓN</strong>
            </button>
            </div>
        </div> <!-- Fin Cabecera -->

	 <div class="barramenu"> <!-- Barra de menú -->
	            <ul class="nav justify-content-center">
	                <li class="nav-item">
	                    <a class="nav-link active" href="#">INICIO</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link" href="#">NOTICIAS</a>
	                </li>
	               <li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          SERVICIO
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarServicio.html">NUEVO</a>
				          <a class="dropdown-item" href="listarServicios.html">LISTAR SERVICIOS</a>
				         <!--  <div class="dropdown-divider"></div>
				          <a class="dropdown-item" href="#">Something else here</a> -->
				        </div>
				      </li>
	                <li class="nav-item">
	                    <a class="nav-link" href="#">SOCIO</a>
	                </li>

	                 <li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          PUBLICACIÓN
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarPublicacion.html">NUEVA</a>
				          <a class="dropdown-item" href="listarPublicacion.html">LISTAR PUBLICACIONES</a>
				        </div>
				      </li>
				  <li class="nav-item dropdown">
				        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				          JUGADOR
				        </a>
				        <div class="dropdown-menu" style="background: #2930A6;" aria-labelledby="navbarDropdown">
				          <a class="dropdown-item" href="ingresarintegrante.html">NUEVO</a>
				          <a class="dropdown-item" href="listarJugadores.html">LISTAR JUGADORES</a>

				        </div>
				      </li> 

	            </ul>
	        </div> <!-- Fin de barra de menú -->

<header>
 <main class="cuerpo_pagina"><!-- CUERPO DE PAGINA -->

     	<div class="cuerporegistro">
			       <form action="#" method="post" enctype="multipart/form-data">
			       
			             <div class="form-group col-md-12">
							<h3 >Modificar Publicación</h3>
					        	<hr style="background: #FFFFFF;">
						 </div>
						 
						 
						 <div class="form-group col-md-12">
						        	<label>Tipo de Publicación</label><br>
							        	<select name="idTipoPublicacion" id="idTipoPublicacion">
								        	<option value="1">Informativo</option>
								        	<option value="2">Administrativo</option>  
											<option value="3">Noticias</option>
								        	<option value="4">Social</option> 
						        		</select>
					        	<br>
				        		
							</div> 
                       
                                <label for="nombre" class="col-form-label">Nombre</label>
                                <input type="text"  class="ingresodatos" id="nombre" placeholder="Nombre..">
                          
							
								<label for="detalle" class="col-form-label">Detalle</label>
								<br></br>
                                <textarea class="ingresodatosdos" id="detalle" rows="3" cols="39	" placeholder="Detalle de Publicación.."></textarea>
                       
                            
							
                                <label for="nombre" class="col-form-label">Autor</label>
                                <input type="text"  class="ingresodatos" id="autor" placeholder="Autor..">
                           


 						
                            	<label for="name" class="col-form-label">Subir foto</label>
                            	<p><img id="output" src="" width="80" class="rounded"></p>
                            	<input type="file" name="file"  accept="image/*" class="form-control"/>
                       			<br>
                       			<br>


                            
                                <input type="submit" class="botonGeneralCentrado" value="Modificar" id="save">
                       
             </form>
      </div>
  	</main><!--  FIN CUERPO DE PAGINA -->
  	
</header>
	<script>
	$(document).ready(function() {
		$(document).delegate('#save', 'click', function() {
					event.preventDefault();

					var nombre = $('#nombre').val();
					var detalle = $('#detalle').val();
					var autor = $('#autor').val();
					var idTipoPublicacion = $('#idTipoPublicacion').val();
					var fecha = new Date()
					
					var img = $('input[name="file"]').get(0).files[0];
					console.log(img)

					var formData = new FormData();
					formData.append('img', img);
					var objArr = [];

					objArr.push({"id": id, "nombre": nombre, "detalle": detalle, "autor": autor, "fecha": fecha, "foto": uuid, "idTipoPublicacion": idTipoPublicacion});
					console.log(objArr);

					formData.append('publicacion', JSON.stringify( objArr ));
					console.log(formData);

					$.ajax({
						type: "PUT",
						//contentType: "application/json; charset=utf-8",
						url: "http://localhost:8080/api/publicacion",
						//data: JSON.stringify({'id': id, 'nombre': document.getElementById("nombre").value, 'preparacion': document.getElementById("preparacion").value, 'dificultad': document.getElementById("dificultad").value}),
						data: formData,
						cache: false,
						processData:false,
						contentType:false,
				        beforeSend: function(xhr) {
				            if (localStorage.token) {
				              xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
				            }
				        },
						success: function() {
							window.location.href = "listarPublicacion.html";
						}
					});
		});

		$('#logout').click(function() {
		      localStorage.clear();
		      window.location.href = "index.html";
		});
	});
	</script>

		<footer ><!-- Footer -->
            <div class="redesolmedo">
                <div class="redes">
                     <div class="contenedor-redes">
                   	 <img src="img/facebook.png">
                    </div>
                    <div class="contenedor-redes">
                   	 <img src="img/instagram.png">
                    </div>
                    <div class="contenedor-redes">
                   	 <img src="img/youtube.png">
                    </div>
                	<div class="contenedor-redes">
                    	<img src="img/twitter.png">
                    </div>
                    <div class="contenedor-redes">
                    	<img src="img/whatsapp.png">
                    </div>
                </div>
            </div>

            <div class="copyright">
                Desarrollado por CODETEAM para CDOLMEDO &copy; Riobamba 2020
            </div>
        </footer><!-- FIN footer-->
        
               <!-- Botstrap -->     
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>

 </body>
</html>
